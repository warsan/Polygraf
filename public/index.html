
<html>
  <head>
    <meta charset="UTF-8">
    <title>Динамические переходы состояний</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenLite.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    
    <style>
      svg { display: block; }
      polygon { fill: #41b883; stroke: #354955; }
      circle { fill: transparent; stroke: #35495e; }
      input[type="range"] { display: block;
                            width: 100%;
                            margin-bottom: 15px;
                          }
    </style>
  </head>
  <body>
    <div id="app">
      <svg width="400" height="400">
        <polygon :points="points"></polygon>
        <circle cx="200" cy="200" r="200"></circle>
      </svg>
      
      <label>Углы: {{ sides }}</label>
      <input type="range" min="3" max="500" v-model.number="sides" />
      <label>Радиус: {{ minRadius }}%</label>
      <input type="range" min="0" max="400" v-model.number="minRadius" />
      <label>Скорость: {{ updateInterval }} миллисекунд</label>
      <input type="range" min="10" max="2000" v-model.number="updateInterval" />
    </div><!-- <script>  alert( 'Привет, мир!' );</script> 
    <script src="poly.js"></script>-->
<script>
    
new Vue({ el: "#app", 
data: function() {
  var ugl = 10;
  var stats = Array.apply(null,
    { length: ugl }).map( function() { return 100; });
    return { stats: stats,
             points: generatePoints(stats),
             sides: ugl,
             minRadius: 50,
             interval: null,
             updateInterval: 1000
            };
          },
          watch: {
            sides: function(newSides, oldSides) {
            var sidesDifference = newSides - oldSides;
            if (sidesDifference > 0) {
              for (var i = 1; i <= sidesDifference; i++) {
                this.stats.push(this.newRandomValue());
              }
            } else {
              var absoluteSidesDifference = Math.abs(sidesDifference);
              for (var j = 1; j <= absoluteSidesDifference; j++) {
                this.stats.shift();
              }
            }
          },
          stats: function(newStats) {
            TweenLite.to(this.$data, this.updateInterval / 1000, {
              points: generatePoints(newStats)
            });
          },
          updateInterval: function() {
            this.resetInterval();
          }
        },
        mounted: function() {
          this.resetInterval();
        },
        methods: {
          randomizeStats: function() {
            var vm = this;
            this.stats = this.stats.map(function() {
              return vm.newRandomValue();
            });
          },
          newRandomValue: function() {
            return Math.ceil(
              this.minRadius + Math.random() * (200 - this.minRadius)
            );
          },
          resetInterval: function() {
            var vm = this;
            clearInterval(this.interval);
            this.randomizeStats();
            this.interval = setInterval(function() {
              vm.randomizeStats();
            }, this.updateInterval);
          }
        }
      });

function valueToPoint(value, index, total) {
        var x = 0;
        var y = -value * 1;
        var angle = ((Math.PI * 2) / total) * index;
        var cos = Math.cos(angle);
        var sin = Math.sin(angle);
        var tx = x * cos - y * sin + 200;
        var ty = x * sin + y * cos + 200;
        return { x: tx, y: ty };
      }

function generatePoints(stats) {
        var total = stats.length;
        return stats
          .map(function(stat, index) {
            var point = valueToPoint(stat, index, total);
            return point.x + "," + point.y;
          })
          .join(" "); //.$mount("#app");
      } // alert( 'Привет, мир!' );

</script>
    <p>Продолжение</p>
  </body>
</html>
